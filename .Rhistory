sd2i = 1.28,
n2i = round(277/4) )
# Study 1, French (Table 1, abbatoir condition)
escalc_add_row( authoryear = "Tian 2016",
substudy = "Study 1, French",
desired.direction = 1,
effect.measure = "smd",
interpretation = "Willingness to eat beef SMD",
use.rr.analysis = 1,
use.grams.analysis = 0,
use.veg.analysis = 0,
measure = "SMD",
m1i = 3.55,
sd1i = 1.30,
n1i = round(243/4),
m2i = 3.78,
sd2i = 1.37,
n2i = round(243/4) )
# Study 2, Chinese (Table 3, animal image condition)
escalc_add_row( authoryear = "Tian 2016",
substudy = "Study 2, Chinese",
desired.direction = 0,
effect.measure = "smd",
interpretation = "Willingness to eat beef",
use.rr.analysis = 1,
use.grams.analysis = 0,
use.veg.analysis = 0,
measure = "SMD",
m1i = 3.61,
sd1i = 1.29,
n1i = round(217/4),  # again, 4 total conditions, but we are only using one of the treatments
m2i = 3.53,
sd2i = 1.36,
n2i = round(217/4) )
# Study 2, French (Table 3, animal image condition)
escalc_add_row( authoryear = "Tian 2016",
substudy = "Study 2, French",
desired.direction = 0,
effect.measure = "smd",
interpretation = "Willingness to eat beef",
use.rr.analysis = 1,
use.grams.analysis = 0,
use.veg.analysis = 0,
measure = "SMD",
m1i = 3.84,
sd1i = 1.30,
n1i = round(301/4),   # again, 4 total conditions, but we are only using one of the treatments
m2i = 3.82,
sd2i = 1.24,
n2i = round(301/4) )
##### Earle 2019 #####
# MM audited 2020-2-3
# emailed to try to get means and SDs,
#  but stuck with converting the point-biserial correlation
# Study 1 (Table 1)
res = r_to_d_ptbis( r = -0.31,
n0 = round(299/2), n1 = round(299/2) )
d = dplyr::add_row(.data = d,
authoryear = "Earle 2019",
substudy = "Study 1",
desired.direction = 1,
effect.measure = "smd",
interpretation = "Willingness to eat meat",
use.rr.analysis = 1,
use.grams.analysis = 0,
use.veg.analysis = 0,
yi = res$d,
vi = res$se^2 )
# Study 2 (Table 3)
res = r_to_d_ptbis( r = -0.35,
n0 = round(280/2), n1 = round(280/2) )
d = dplyr::add_row(.data = d,
authoryear = "Earle 2019",
substudy = "Study 2",
desired.direction = 1,
effect.measure = "smd",
interpretation = "Willingness to eat meat",
use.rr.analysis = 1,
use.grams.analysis = 0,
use.veg.analysis = 0,
yi = res$d,
vi = res$se^2 )
##### Flens (2018) #####
# MM audited 2020-2-4
# Table 1 (page 4)
# create aggregated measure: consumption of all animal products
#  by summing each category they report
# per page 2, negative values represent decreases in consumption; positive indicate increases
( sum.trt = sum( c( 0.34, -0.04, -0.90, 1.21, 0.57, 0.12 ) ) )
( sum.cntrl = sum( c( 0.42, -0.01, -0.88, 0.84, 0.52, 0.20 ) ) )
# assume independence for conservative pooled SE
# emailed to try to get non-conservative SD, but to no avail
( sd.trt.pooled = sqrt( 1.57^2 + 1.58^2 + 1.24^2 + 1.27^2 + 1.62^2 + 1.35^2 ) )
( sd.cntrl.pooled = sqrt( 1.40^2 + 1.27^2 + 1.55^2 + 1.30^2 + 1.43^2 + 1.41^2 ) )
escalc_add_row( authoryear = "Flens 2018",
substudy = NA,
desired.direction = 0,
effect.measure = "smd",
interpretation = "Animal products consumption frequency",
use.rr.analysis = 1,
use.grams.analysis = 0,
use.veg.analysis = 0,
measure = "SMD",
m1i = sum.trt,
sd1i = sd.trt.pooled,
n1i = 52,  # page 3
m2i = sum.cntrl,
sd2i = sd.cntrl.pooled,
n2i = 200 )  # page 3
##### **Schwitzgebel (2019) #####
# MM audited 2020-2-4
d = dplyr::add_row(.data = d,
authoryear = "Schwitzgebel 2019",
desired.direction = 1,
effect.measure = "log-rr",
interpretation = "Purchase contained meat",
use.rr.analysis = 1,
use.grams.analysis = 0,
use.veg.analysis = 0,
yi = -0.13597,
vi = 0.007144952 )
##### **FIAPO (2017) #####
# MM audited 2020-2-4
(91-2) + (188-21) + # Study 1, baseline non-vegans in control group (excluded the baseline vegans)
1000 + # from raw data
1040  # from raw data
# Study 1: leafleting
# combine data in Table A and Table 1 to get RR of *becoming* vegan
#  among initial non-vegans
escalc_add_row( authoryear = "FIAPO 2017",
substudy = "leaflet",
desired.direction = 1,
effect.measure = "log-rr",
interpretation = "Going vegan",
use.rr.analysis = 1,
use.grams.analysis = 0,
use.veg.analysis = 0,
measure = "RR",
# proportions from Table A; N's from Table 1
ai = round( 0.005*21 + 0.0266*146 ), # Tx who *went* vegan, of initial non-vegans
bi = round( (188-21) - round(0.005*21 + 0.0266*146) ),  # Tx who did not *go* vegan, of initial non-vegans
ci = 0,  # control who went vegan
di = 91-2 ) # control who did not go vegan
# Study 2: 2D video
# from raw data
escalc_add_row( authoryear = "FIAPO 2017",
substudy = "2D video",
desired.direction = 1,
effect.measure = "smd",
interpretation = "Willingness to reduce meat",
use.rr.analysis = 1,
use.grams.analysis = 0,
use.veg.analysis = 0,
measure = "SMD",
m1i = 4.847619,
sd1i = 1.89707,
n1i = 525,
m2i = 3.95534,
sd2i = 2.048048,
n2i = 515 )
# Study 3: virtual reality
# from raw data
escalc_add_row( authoryear = "FIAPO 2017",
substudy = "virtual reality",
desired.direction = 1,
effect.measure = "smd",
interpretation = "Willingness to reduce meat",
use.rr.analysis = 1,
use.grams.analysis = 0,
use.veg.analysis = 0,
measure = "SMD",
m1i = 3.707052,
sd1i = 2.594777,
n1i = 553,
m2i = 6.550336,
sd2i = 2.983744,
n2i = 447 )
##### Rouk 2017 #####
# MM audited 2020-2-4
# this one had a ton of effect sizes, so was prepped more automatically
setwd(original.data.dir)
setwd("Rouk 2017, #3832")
d = rbind( d, read.csv("rouk_prepped_effect_sizes.csv")[,-1] )
##### **ACE 2013a #####
# "Compassionate Choices"
d = dplyr::add_row(.data = d,
authoryear = "ACE 2013a",
substudy = '"Compassionate Choices"',
desired.direction = 0,
effect.measure = "log-rr",
interpretation = "Low vs. high animal product consumption",
use.rr.analysis = 1,
use.grams.analysis = 0,
use.veg.analysis = 0,
yi = -0.3883008,
vi = 0.1138651 )
# "Even if You Like Meat"
d = dplyr::add_row(.data = d,
authoryear = "ACE 2013a",
substudy = '"Even If You Like Meat"',
desired.direction = 1,
effect.measure = "log-rr",
interpretation = "Low vs. high animal product consumption",
use.rr.analysis = 1,
use.grams.analysis = 0,
use.veg.analysis = 0,
yi = 0.001426734,
vi = 0.008177298 )
##### **ACE 2013b #####
# MM audited 2020-2-4
d = dplyr::add_row(.data = d,
authoryear = "ACE 2013b",
desired.direction = 0,
effect.measure = "smd",
interpretation = "Low vs. high animal product consumption",
use.rr.analysis = 1,
use.grams.analysis = 0,
use.veg.analysis = 0,
yi = -0.08581416,
vi = 0.01900103 )
##### Feltz 2019, #3858 #####
# MM audited 2020-2-5
# stats and sample sizes on page 11
# this is the SMD of the gain scores themselves
d = escalc_add_row( authoryear = "Feltz 2019",
substudy = NA,
desired.direction = 0,
effect.measure = "smd",
interpretation = "Within-subject change in animal product consumption",
use.rr.analysis = 1,
use.grams.analysis = 0,
use.veg.analysis = 0,
measure = "SMD",
m1i = 0.14,  # intervention
sd1i = 1.82,
n1i = 58,
m2i = -0.04,  # control
sd2i = 1.44,
n2i = 43 )
##### **Lackner 2019, #3858 #####
# MM audited 2020-2-5
d = dplyr::add_row(.data = d,
authoryear = "Lackner 2019",
desired.direction = 0,
effect.measure = "log-rr",
interpretation = "Low vs. high intended meat consumption",
use.rr.analysis = 1,
use.grams.analysis = 0,
use.veg.analysis = 0,
yi = -0.3542,
vi = 0.0817 )
###### **Norris 2014 #####
# MM audited 2020-2-5
# "Your Choice"
d = dplyr::add_row(.data = d,
authoryear = "Norris 2014",
substudy = '"Your Choice"',
desired.direction = 0,
effect.measure = "log-rr",
interpretation = "Low vs. high animal product consumption",
use.rr.analysis = 1,
use.grams.analysis = 0,
use.veg.analysis = 0,
yi = -0.108307,
vi = 0.01944182 )
# "Even If You Like Meat"
d = dplyr::add_row(.data = d,
authoryear = "Norris 2014",
substudy = '"Even If You Like Meat"',
desired.direction = 0,
effect.measure = "log-rr",
interpretation = "Low vs. high animal product consumption",
use.rr.analysis = 1,
use.grams.analysis = 0,
use.veg.analysis = 0,
yi = -0.05842669,
vi = 0.02098244 )
# ##### deLanauze 2019, #4033 #####
#
# # get SDs from p-values and means
#
# p =
#
# sd.cntrl = ( hw.cntrl / qt(.975, df = n.cntrl-1) ) * sqrt(n.cntrl)
# # sanity check
#
# d = dplyr::add_row(.data = d,
#                    authoryear = "deLanauze 2019",
#                    desired.direction = ,
#                    effect.measure = "smd",
#                    interpretation = "",
#                    use.rr.analysis = 1,
#                    use.grams.analysis = 0,
#                    use.veg.analysis = 0,
#                    yi = ,
#                    vi = )
#
#
# # confirm equivalence of transformation
# n0 = 100
# n1 = 100
# y0 = rnorm(n=n0, mean=0, sd=2)
# y1 = rnorm(n=n1, mean=y0 + 1, sd=2)  # make them correlated
# diff = y1-y0
#
# # independent-samples t-test
# t1 = t.test(y0, y1)$statistic
#
# # paired t-test
# t2 = t.test(y0, y1, paired = TRUE)$statistic
#
#
# # directly calculate d
# escalc( measure = "SMD",
#
#                 m1i = mean(y0),
#                 sd1i = sd(y0),
#                 n1i = n0,  # sample sizes on pg 52
#
#                 m2i = mean(y1),
#                 sd2i = sd(y1),
#                 n2i = n1 )
#
# t * sqrt( (n0+n1) / (n0*n1) )
#
# # they did a paired t-test, but we're treating as independent, so t-value we use
#  will be larger than it should be, so resulting d will be larger than what we
#  would have gotten with direct independent calculation
# save intermediate dataset
setwd(data.dir)
write.csv(d, "data_prepped_step1.csv", row.names = FALSE)
# Notes:
#
#  ** = had raw data; see 1_get_effect_sizes_from_raw.R for how we calculated the estimates
#
#  - Analyzing on RR scale, not SMD, because for many studies, the Chinn assumption of an underlying
#   normal RV seems not reasonable. For others, the common-outcome assumption seems questionable.
#   With this modification, we assume the SMDs are computed on normal data, which seems more reasonable.
#   Used square-root transformation when outcome was rare or if we couldn't tell.
#
# - Tried to calculate RRs contrasting "high" vs. "low" meat consumption per each study's definition of those
#   terms. Sometimes these differed from study's own analyses (e.g., Anderson 2017, for which their model estimated
#   cumulative logit ORs for ordinal categories of consumption). When the outcome was about reducing vs. increasing
#   future meat consumption, we dichotomized at "staying the same".
#
# - For longitudinal controlled studies with pre/post measures, when available, used DID rather than just comparison
#  at final time point. Used latter if it was the only thing available.
#
# - For longitudinal studies with multiple post-intervention time points, we used the one with the longest
#   follow-up.
#
# - When there were multiple point estimates on same subjects, but our hierarchy didn't help decide between them,
#   we averaged the effect sizes within a study and assumed independence for a conservative SE (e.g., Hennessy).
#
# - When raw data were available, we calculated the RR for being below vs. above median meat consumption, where "median"
#   is the median at baseline among both control and treateds in a longitudinal study, or the median among controls in a
#   a 2-group study. In longitudinal studies, we controlled for meat consumption at baseline (treated as continuous).
#   When a servings variable wasn't available, we tried to instead dichotomize at "reduce meat consumption" vs. "stay
#   the same or increase" (e.g., Reese 2015).
#
#  - When different interventions in the study had different scopes (e.g., one leaflet says "go vegetarian" but another says
#   "go vegan"), defined outcome based on the most stringent intervention (e.g., vegan > vegetarian). See, e.g., Cooney 2015.
# Other notes
#  - When possible, calculated sample size and percent male ourselves, which is why it sometimes differed from
#  what's reported in paper (e.g., due to missing data or exclusion of some conditions that weren't eligible)
#
# - Sometimes get_rr_adj's proportion of missing data differs from what we entered in
#  qualitative spreadsheet. This is intentional. get_rr_adj is only aware of missing data
#  due to observations that are in the raw data, but are dropped in analysis. Sometimes we
#  knew there was additional missing data that were not even in the raw data.
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #
#                                           PRELIMINARIES                                             #
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #
library(metafor)
library(dplyr)
library(testthat)
library(readxl)
library(stringr)
data.dir = "~/Dropbox/Personal computer/Independent studies/2019/AWR (animal welfare review meat consumption)/Linked to OSF (AWR)/Data extraction"
code.dir = "~/Dropbox/Personal computer/Independent studies/2019/AWR (animal welfare review meat consumption)/Linked to OSF (AWR)/Data extraction/awr_data_extraction_git"
# location of original datasets and code for reproducible studies
original.data.dir = "~/Dropbox/Personal computer/Independent studies/2019/AWR (animal welfare review meat consumption)/Literature search/Full texts for review/*INCLUDED STUDIES"
setwd(code.dir); source("helper_extraction.R")
d = as.data.frame( matrix( ncol = 10, nrow = 0 ) )
names(d) = c( "authoryear",
"substudy",
"desired.direction",
"effect.measure",
"interpretation",
"use.rr.analysis",
"use.grams.analysis",
"use.veg.analysis",
"yi",
"vi")
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #
#                                  STEP 1 - MAIN-ANALYSIS STUDIES                                      #
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #
# asterisks denote studies with raw data
##### **Amiot 2018 (PLOS) #####
# MM audited 2020-2-2
d = dplyr::add_row(.data = d,
authoryear = "Amiot 2018",
substudy = NA,
desired.direction = 1,
effect.measure = "log-rr",
interpretation = "Low vs. high 1-week consumption",
use.rr.analysis = 1,
use.grams.analysis = 0,
use.veg.analysis = 0,
yi = 0.395127,
vi = 5.670225e-02 )
##### **Anderson 2016 (PLOS), Study 3 ######
# MM audited 2020-2-2
# same study, 3 effect sizes for different analyses
d = dplyr::add_row(.data = d,
authoryear = "Anderson 2016",
substudy = NA,
desired.direction = 1,
effect.measure = "log-rr",
interpretation = "Low vs. high consumption",
use.rr.analysis = 1,
use.grams.analysis = 0,
use.veg.analysis = 0,
yi = 0.1092,
vi = 0.0060 )
library(metafor)
library(dplyr)
library(testthat)
library(readxl)
library(stringr)
data.dir = "~/Dropbox/Personal computer/Independent studies/2019/AWR (animal welfare review meat consumption)/Linked to OSF (AWR)/Data extraction"
code.dir = "~/Dropbox/Personal computer/Independent studies/2019/AWR (animal welfare review meat consumption)/Linked to OSF (AWR)/Data extraction/awr_data_extraction_git"
# location of original datasets and code for reproducible studies
original.data.dir = "~/Dropbox/Personal computer/Independent studies/2019/AWR (animal welfare review meat consumption)/Literature search/Full texts for review/*INCLUDED STUDIES"
setwd(code.dir); source("helper_extraction.R")
d = as.data.frame( matrix( ncol = 10, nrow = 0 ) )
names(d) = c( "authoryear",
"substudy",
"desired.direction",
"effect.measure",
"interpretation",
"use.rr.analysis",
"use.grams.analysis",
"use.veg.analysis",
"yi",
"vi")
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #
#                                  STEP 1 - MAIN-ANALYSIS STUDIES                                      #
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #
# asterisks denote studies with raw data
##### **Amiot 2018 (PLOS) #####
# MM audited 2020-2-2
d = dplyr::add_row(.data = d,
authoryear = "Amiot 2018",
substudy = NA,
desired.direction = 1,
effect.measure = "log-rr",
interpretation = "Low vs. high 1-week consumption",
use.rr.analysis = 1,
use.grams.analysis = 0,
use.veg.analysis = 0,
yi = 0.395127,
vi = 5.670225e-02 )
head(d)
mode(d$authoryear)
?checkpoint
getwd()
installed.packages()
# load packages
library(checkpoint)
# save the package environment that MBM used when analyzing
checkpoint("2020-02-12")
library(metafor)
library(dplyr)
library(testthat)
library(readxl)
library(stringr)
data.dir = "~/Dropbox/Personal computer/Independent studies/2019/AWR (animal welfare review meat consumption)/Linked to OSF (AWR)/Data extraction"
code.dir = "~/Dropbox/Personal computer/Independent studies/2019/AWR (animal welfare review meat consumption)/Linked to OSF (AWR)/Data extraction/awr_data_extraction_git"
# location of original datasets and code for reproducible studies
original.data.dir = "~/Dropbox/Personal computer/Independent studies/2019/AWR (animal welfare review meat consumption)/Literature search/Full texts for review/*INCLUDED STUDIES"
setwd(code.dir); source("helper_extraction.R")
d = as.data.frame( matrix( ncol = 10, nrow = 0 ) )
names(d) = c( "authoryear",
"substudy",
"desired.direction",
"effect.measure",
"interpretation",
"use.rr.analysis",
"use.grams.analysis",
"use.veg.analysis",
"yi",
"vi")
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #
#                                  STEP 1 - MAIN-ANALYSIS STUDIES                                      #
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #
# asterisks denote studies with raw data
##### **Amiot 2018 (PLOS) #####
# MM audited 2020-2-2
d = dplyr::add_row(.data = d,
authoryear = "Amiot 2018",
substudy = NA,
desired.direction = 1,
effect.measure = "log-rr",
interpretation = "Low vs. high 1-week consumption",
use.rr.analysis = 1,
use.grams.analysis = 0,
use.veg.analysis = 0,
yi = 0.395127,
vi = 5.670225e-02 )
citation(dplyr)
citation("dplyr")
